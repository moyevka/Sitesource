<!-- links -->
<link rel="stylesheet" href="..\css\global.css">
<link rel="preload" href="..\css\fonts\MatissePixelated.woff2" as="font" crossorigin>
<link rel="preload" href="..\css\fonts\MatissePixelated.woff" as="font" crossorigin>
<link rel="preload" href="..\css\fonts\naps\NapsSorrel.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="..\css\fonts\naps\NapsKeys.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="..\css\fonts\naps\NapsChoux.woff2" as="font" type="font/woff2" crossorigin>

<!-- Montserrat -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

<!-- DM Sans -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap" rel="stylesheet">

<!-- pixel filter -->
<svg class="offscreen" width="0" height="0" xmlns="http://www.w3.org/2000/svg">
    <defs>
        <filter id="binary">
            <feComponentTransfer>
                <feFuncA type="discrete" tableValues="0 1"/>
            </feComponentTransfer>
        </filter>
    </defs>
</svg>

<!-- whiteout opener -->
<script>
const splash = document.createElement('div');
splash.classList.add('opener');
document.body.appendChild(splash);

function removeSplash(){
    const splash = document.querySelector('.opener');
    if (splash) {
        splash.style.opacity = '0';
        setTimeout(() => {
            splash.remove();
        }, 1000);
    }
}
</script>

<!-- image viewer -->
<script>
document.addEventListener('DOMContentLoaded', function () {
const images = document.querySelectorAll('.clickable');
    let overlay, viewerImage, isZoomed = false;

    images.forEach(image => {
        image.addEventListener('click', function () {
            if (!overlay) {
                // Create overlay and viewer image elements
                overlay = document.createElement('div');
                overlay.className = 'image-overlay';

                viewerImage = document.createElement('img');
                viewerImage.src = image.src;
                viewerImage.className = 'viewer-image';

                const closeMessage = document.createElement('div');
                closeMessage.innerText = 'right-click anywhere to close';
                closeMessage.className = 'close-message';

                if (image.classList.contains('naps-img')) {
                    viewerImage.classList.add('naps-img');
                    closeMessage.classList.add('binary');
                }

                overlay.appendChild(closeMessage);
                overlay.appendChild(viewerImage);
                document.body.appendChild(overlay);

                setTimeout(() => {
                    overlay.style.opacity = 1;
                }, 100);

                // Handle zoom-in with mouse position offset
                viewerImage.addEventListener('click', function (e) {
                    e.stopPropagation(); 
                    if (!isZoomed) {
                        const rect = viewerImage.getBoundingClientRect();
                        const percentX = ((e.clientX - rect.left) / rect.width);
                        const percentY = ((e.clientY - rect.top) / rect.height);
                        viewerImage.style.transformOrigin = `${percentX * 100}% ${percentY * 100}%`;

                        viewerImage.classList.add('zoomed');
                        isZoomed = true;
                        overlay.style.cursor = 'zoom-out';
                    } else {
                        viewerImage.classList.remove('zoomed');
                        isZoomed = false;
                        overlay.style.cursor = 'zoom-in';
                    }
                });
                
                // Continuously update transformOrigin on mousemove when zoomed
                overlay.addEventListener('mousemove', function (e) {
                    if (isZoomed) {
                        const rect = viewerImage.getBoundingClientRect();
                        const percentX = ((e.clientX - rect.left) / rect.width);
                        const percentY = ((e.clientY - rect.top) / rect.height);
                        viewerImage.style.transformOrigin = `${percentX * 100}% ${percentY * 100}%`;
                    }
                });

                function closeViewer() {
                    overlay.style.opacity = 0;
                    setTimeout(() => {
                        document.body.removeChild(overlay);
                        overlay = null;
                        viewerImage = null;
                        isZoomed = false;
                    }, 100);
                };

                // Exit viewer on overlay click
                overlay.addEventListener('click', function () {
                    if (!isZoomed) {
                        closeViewer();
                    } else {
                        viewerImage.classList.remove('zoomed');
                        isZoomed = false;
                        overlay.style.cursor = 'zoom-in';
                    }
                });

                // Exit viewer on right-click anywhere
                overlay.addEventListener('contextmenu', function (e) {
                    e.preventDefault();
                    closeViewer();
                });
            }
        });
    });
});
</script>